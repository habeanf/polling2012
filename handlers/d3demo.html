<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <style type="text/css">
        body {
          font: 10px sans-serif;
        }

        .axis path, .axis line {
          fill: none;
          stroke: #000;
          shape-rendering: crispEdges;
        }
        /*
         * Socialite Look-a-like defaults
         */

        #social { display: block; list-style: none; padding: 0; margin: 20px; }
        #social > li { display: block; margin: 0; padding: 10px; float: left; }
        #social .socialite { display: block; position: relative; background: url('images/social-sprite.png') 0 0 no-repeat; }
        #social .socialite-loaded { background: none !important; }

        #social .twitter-share { width: 55px; height: 65px; background-position: 0 0; }
        #social .googleplus-one { width: 50px; height: 65px; background-position: -75px 0; }
        #social .facebook-like { width: 50px; height: 65px; background-position: -145px 0; }
        #social .linkedin-share { width: 60px; height: 65px; background-position: -215px 0; }
        #social .stumbleupon { width: 50px; height: 65px; background-position: -295px 0; }
    </style>
    <title>US Polling 2012</title>
    <script type="text/javascript" src="/static/d3.v2.js"></script>
    <script type="text/javascript" src="/static/polling.js"></script>
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', '{{ga_id}}']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
  
    </script>    
  </head>
    <body>
      <a href="https://github.com/habeanf/polling2012"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png" alt="Fork me on GitHub"></a>
      <h1>2012 Presidential Elections</h1>
      <h2>US Statewide Polling</h2>
      <h3>Last Update: {{lastupdate}}</h3>
      <svg class="graphsvg"></svg>
      <p>
        Red - Romney / Ryan
        <br/>
        Blue - Obama / Biden
        <br/>
        <br/>
        Source:
        <a href="http://en.wikipedia.org/wiki/Statewide_opinion_polling_for_the_United_States_presidential_election,_2012">
        http://en.wikipedia.org/wiki/Statewide_opinion_polling_for_the_United_States_presidential_election,_2012
        </a>
      </p>
          <ul id="social" class="cf">
        <li>
            <a href="http://twitter.com/share" class="socialite twitter-share" data-via="habeanf" data-text="US&nbsp;Polling&nbsp;2012" data-url="http://uspolling2012.appspot.com/" data-count="vertical" rel="nofollow" target="_blank">
                <span class="vhidden">Share on Twitter</span>
            </a>
        </li>
        <li>
            <a href="https://plusone.google.com/_/+1/confirm?hl=en&amp;url==http://uspolling2012.appspot.com/" class="socialite googleplus-one" data-size="tall" data-href="=http://uspolling2012.appspot.com/" rel="nofollow" target="_blank">
                <span class="vhidden">Share on Google+</span>
            </a>
        </li>
        <li>
            <a href="http://www.facebook.com/sharer.php?u=http://uspolling2012.appspot.com/&amp;t=US&nbsp;Polling&nbsp;2012" class="socialite facebook-like" data-href="http://uspolling2012.appspot.com/" data-send="false" data-layout="box_count" data-width="60" data-show-faces="false" rel="nofollow" target="_blank">
                <span class="vhidden">Share on Facebook</span>
            </a>
        </li>
        <li>
            <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http://uspolling2012.appspot.com/&amp;title=US&nbsp;Polling&nbsp;2012" class="socialite linkedin-share" data-url="http://uspolling2012.appspot.com/" data-counter="top" rel="nofollow" target="_blank">
                <span class="vhidden">Share on LinkedIn</span>
            </a>
        </li>
        <li>
            <a href="http://pinterest.com/pin/create/button/?url=http://uspolling2012.appspot.com/&amp;description=US&nbsp;Polling&nbsp;2012" class="socialite pinterest-pinit" data-count-layout="vertical">
                <span class="vhidden">Pin It!</span>
            </a>
        </li>
    </ul>
  	<script type="text/javascript">
    	var data                = {{data}};
      var preferences         = {LVRV:'LV',polltype:-1};
      var SWING_MARGIN_PCT    = 6;
      var POLL_DEFAULT_MARGIN = 4;
      var UNKNOWN_STATES      =
      [{name:'Alaska',votes:3,polls:[],
        2004:['Republican',[61.1,35.5]],
        2008:['Republican',[59.4,37.9]]},
       {name:'Delaware',votes:3,polls:[],
        2004:['Democratic',[53.4,45.8]],
        2008:['Democratic',[61.9,36.9]]},
       {name:'DC',votes:3,polls:[],
        2004:['Democratic',[89,9]],
        2008:['Democratic',[92.46,6.53]]},
       {name:'Idaho',votes:4,polls:[],
        2004:['Republican',[68.4,30.3]],
        2008:['Republican',[61.3,36]]},
       {name:'Wyoming',votes:3,polls:[],
        2004:['Republican',[68.9,29.1]],
        2008:['Republican',[64.8,32.5]]}];
        
      window._socialite = window._socialite || [];
      window._socialite.push(function() {
          // add pinterest extension
          (function(a,b,c,d){c.network("pinterest",{script:{src:"//assets.pinterest.com/js/pinit.js"}}),c.widget("pinterest","pinit",{process:function(a){if(a.el.nodeName.toLowerCase()!=="a")return!0;var b="socialite-instance-"+a.uid,c=a.el.getAttribute("href");a.el.id=b,a.el.href="#"+b,a.el.setAttribute("data-default-href",c),a.el.setAttribute("onclick",'(function(){window.open("'+c+'")})();')},init:function(a){c.processInstance(a);var d=b.createElement("a");d.className="pin-it-button",c.copyDataAttributes(a.el,d),d.setAttribute("href",a.el.getAttribute("data-default-href")),d.setAttribute("count-layout",a.el.getAttribute("data-count-layout")||"horizontal"),a.el.appendChild(d),c.networkReady("pinterest")&&c.reloadNetwork("pinterest")}})})(window,window.document,window.Socialite);

          Socialite.load(document.getElementById('social'));
          Socialite.activate(document.getElementById('follow-button'), 'twitter-follow');
      });

      var docReady = function() {
          // parse date objects for later use; new Date(x) expects can parse x if x is isoformat (YYYY-MM-DD...)
          data.forEach(function (state) {
            state.polls.forEach(function (poll) {
              poll.fromDate = getData(poll.fromDate);
              poll.toDate   = getData(poll.toDate);;
            });
          });
        
          calculateData();
          margin = {top: 20, right: 30, bottom: 30, left: 40},
          width = 960 - margin.left - margin.right,
          height = 500 - margin.top - margin.bottom;

          x = d3.time.scale()
          .range([0, width]);

          y = d3.scale.linear()
              .range([height, 0]);

          z = d3.scale.ordinal()
              .range(['#3182bd','#6baed6','#dddddd','#fdae6b','#e6550d' ]);

          yAxis = d3.svg.axis()
              .scale(y)
              .orient("left")
              .tickValues([135,270,403,538]);

          yAxis2 = d3.svg.axis()
              .scale(y)
              .orient("right")
              .tickValues([135,270,403,538]);

          area = d3.svg.area()
              .interpolate("cardinal")
              .x(function(d) { return x(d.date); })
              .y0(function(d) { return y(d.y0); })
              .y1(function(d) { return y(d.y0 + d.y); });

          x.domain(d3.extent(fdata, function(d) { return d.date; }));
          y.domain([0, d3.max(fdata, function(d) { return d.y0 + d.y; })]);


          xAxis = d3.svg.axis()
              .scale(x)
              .orient("bottom")
              .ticks(d3.time.months);

          svg = d3.select(".graphsvg")
              .attr("width", width + margin.left + margin.right)
              .attr("height", height + margin.top + margin.bottom)
              .append("g")
              .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

          svg.selectAll(".layer")
              .data(layers)
            .enter().append("path")
              .attr("class", "layer")
              .attr("d", function(d) { return area(d.values); })
              .style("fill", function(d, i) { return z(i); });

          svg.append("g")
              .attr("class", "x axis")
              .attr("transform", "translate(0," + height + ")")
              .call(xAxis);

          svg.append("g")
              .attr("class", "y axis")
              .call(yAxis);
          
          svg.append("g")
              .attr("class", "y axis")
              .attr("transform", "translate(" + width + ",0)")
              .call(yAxis2);

          var s  = document.getElementsByTagName('script')[0],
              js = document.createElement('script');
          js.type = 'text/javascript';
          js.async = true;
          js.src = '/static/socialite.min.js';
          s.parentNode.insertBefore(js, s);
      };

      if (typeof window.addEventListener === 'function') {
          window.addEventListener('DOMContentLoaded', docReady, false);
      } else {
          window.onload = function() { docReady(); };
      }

    </script>
  </body>
</html>


